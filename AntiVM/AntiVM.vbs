	Sub Main()
        Call check_services()
        Call check_processes()
        Call check_macs()
    End Sub

    Sub check_services()
		Dim servicesToDetect
        servicesToDetect = Array("VMwareCAFManagementAgentHost", "vmtools", "vmhgfs", "vmmemctl", "vmmouse", "vmrawdsk", "vmusbmouse", "vmvss", "vmscsi", "vmxnet", "vmx_svga", "vmware tools", "vmware physical disk helper service")
        For Each service In GetObject("winmgmts:\\.\root\CIMV2").ExecQuery("Select * from Win32_Service")
            For i = 0 To UBound(servicesToDetect)
                If StrComp(servicesToDetect(i), service.Name, vbTextCompare) = 0 Then
					Wscript.Echo "Found " & servicesToDetect(i)
                    Exit For
                End If
            Next
            ' Console.WriteLine(service.Name & "/" & service.StartName & "/" & service.state)
        Next
    End Sub

 Sub check_processes()
		Dim processesToDetect
        Dim psList
		processesToDetect = Array("vmtoolsd", "vmwaretray", "vmwareuser", "vmacthlp", "vboxservice", "vboxtray")
        For Each p In GetObject("winmgmts:\\.\root\CIMV2").ExecQuery("Select * from Win32_Process")
            For i = 0 To UBound(processesToDetect)
                If StrComp(processesToDetect(i), p.Name, 0) = 0 Then
					Wscript.Echo "Found " & processesToDetect(i)
                    Exit For
                End If
            Next
        Next
    End Sub

    Sub check_macs()
		Dim macList
        Dim prefix
        macList = Array("00:05:69", "00:0C:29", "00:1C:14", "00:50:56", "08:00:27")
		GetObject("winmgmts:\\.\root\cimv2").ExecQuery("Select * from Win32_NetworkAdapter where physicaladapter=true")
        For Each nad In GetObject("winmgmts:\\.\root\cimv2").ExecQuery("Select * from Win32_NetworkAdapter where physicaladapter=true")
            If Not isNull(nad.MACAddress) Then
				prefix = Mid(nad.MACAddress,1, 8)
                For i = 0 To UBound(macList)
                    If StrComp(prefix, macList(i), 0) = 0 Then
						Wscript.Echo "Found MAC Address " & nad.MACAddress
                        Exit For
                    End If
                Next
            End If
        Next
    End Sub

	Call Main()
